<!DOCTYPE html>
<html lang="en">
    <head>
      <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
      <link rel="manifest" href="/site.webmanifest">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

      <title>Patrick José Pereira</title>

      <!-- CSS -->
      <link rel="stylesheet" href="https://patrickelectric.work/print.css" media="print">
      <link rel="stylesheet" href="https://patrickelectric.work/poole.css">
      <link rel="stylesheet" href="https://patrickelectric.work/hyde.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

      <!-- Math rendering -->
	    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
      onload="renderMathInElement(document.body, { delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}, {left: '\\[', right: '\\]', display: true}, {left: '\\(', right: '\\)', display: false}]});"></script>

      

      
      
    </head>

    <body class=" ">
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/js/all.min.js"></script>
        
            <div class="sidebar">
                <div class="container sidebar-sticky">
                    <div class="sidebar-about">
                        
                          <a href="https:&#x2F;&#x2F;patrickelectric.work"><h2>HOME</h2></a>
                            <div class="avatar"> <img src="https://avatars3.githubusercontent.com/patrickelectric" alt="Patrick José Pereira" itemprop="image"> </div>
                            <h6>Patrick José Pereira</h6>
                            
                            <p class="lead">I am an Electronics Engineer that works with robotic systems, OSS and OSH.</p>
                            <div class="author__urls-wrapper">
                              <!-- Place this tag in your head or just before your close body tag. -->
                              <script async defer src="https://buttons.github.io/buttons.js"></script>
                              <!-- Place this tag where you want the button to render. -->
                              <a class="github-button" href="https://github.com/patrickelectric" data-show-count="true" aria-label="Follow @patrickelectric on GitHub">Follow @patrickelectric</a>
                              <ul class="author__urls social-icons">

                                  <li itemprop="homeLocation" itemscope="" itemtype="http://schema.org/Place">
                                    <i class="fas fa-map-marker-alt"></i> Brazil
                                  </li>
                                  <li>
                                    <a href="mailto:patrickjp@kde.org">
                                      <meta itemprop="email" content="patrickjp@kde.org">
                                      <i class="fas fa-envelope-square"></i> Email
                                    </a>
                                  </li>
                                  <li>
                                    <a href="https://github.com/patrickelectric">
                                      <i class="fab fa-github-square"></i> GitHub
                                    </a>
                                  </li>
                                  <li>
                                    <a href="https://www.linkedin.com/in/patrickelectric/">
                                      <i class="fab fa-linkedin"></i> LinkedIn
                                    </a>
                                  </li>
                              </ul>
                            </div>
                            
                        
                    </div>

                    <ul class="sidebar-nav">
                        
                        
                        
                    </ul>
                </div>
            </div>
        

        <div class="content container">
            
<div class="post">
  <h1 class="post-title">How to rock: First tips</h1>
  <span class="post-date">2020-08-08</span>
  <h3 class="post-tags">[
  
  <a href="/tags/kde">kde</a>
  
  <a href="/tags/development">development</a>
  
  <a href="/tags/tutorial">tutorial</a>
  
  <a href="/tags/how-to-rock">how-to-rock</a>
  
  ]</h3>
  <p>After working for some time collaborating with open source/free software projects, I started to help newcomers to contribute and push the development further with good practices.</p>
<p>This post will try to itemize some important tips that can be used for software collaboration and personal projects, hopefully it'll help you to have a solid ground of good practices and advices for your contributions in a project. It contains information abut good code practices, a simple guide of helpful API design, code organization, comments, naming variables, development flow and self-criticism. Please enjoy, and any feedback (including critics) is much appreciated!</p>
<span id="continue-reading"></span><h1 id="code-practices">Code practices</h1>
<ul>
<li>
<p><strong>Encapsulate magic variables</strong>:</p>
<pre data-lang="cpp" class="language-cpp "><code class="language-cpp" data-lang="cpp">...&#x2F;&#x2F; First version
  start_communication(0, 1, 232);
  &#x2F;&#x2F; Reviewer: What is the meaning of 0 ? What is 1 ? Why 232 ?

...&#x2F;&#x2F; Second version
  enum class Messages {
      ...
      RequestStatus = 232,
  }
  ...
  const uint8_t vid = 0;
  const uint8_t cid = 1;
  start_communication(vid, cid, Messages::RequestStatus);
  &#x2F;&#x2F; Reviewer: What is vid ? What is cid ?

...&#x2F;&#x2F;Final version
  ...
  const uint8_t vehicle_id = 0;
  const uint8_t component_id = 1;
  start_communication(vehicle_id, component_id, Messages::RequestStatus);
</code></pre>
<p>As you can see, the final version makes everything more readable, we know that we are starting the communication with a vehicle that has an id of 0 and the vehicle probably contains a component with id 1, and while calling this function we are also requesting the status. Much better than 0, 1 and 232 right ?
Doing this will help the reviewers and future developers to understand what is the meaning of such numbers.
It's also necessary to avoid variables that contains only single letters or really short abbreviations, is much harder to understand this: $$C^2 = A^2 + B^2$$
over this: $$hypotenuse^2 = catheti_1^2 + catheti_2^2$$</p>
</li>
<li>
<p><strong>Avoid multiple arguments</strong>:</p>
<pre data-lang="cpp" class="language-cpp "><code class="language-cpp" data-lang="cpp">...&#x2F;&#x2F; First version
auto vehicle = new Vehicle(
    VehicleType::Car,
    4,
    {28, 31},
    Fuel::Electric,
    1.2,
    613
);
&#x2F;&#x2F; Reviewer: What is the meaning of all this values ?
&#x2F;&#x2F;           How can we make it better ?

...&#x2F;&#x2F; Second version
auto vehicle = new Vehicle(VehicleType::Car)
vehicle-&gt;setNumberOfTires(4);
vehicle-&gt;setTirePressure({28, 31});
vehicle-&gt;setFuel(Fuel::Electric);
vehicle-&gt;setWeightInTons(1.2);
vehicle-&gt;setAutonomyInKm(613);

...&#x2F;&#x2F; It&#x27;s also possible to use aggregate initialization in C++20
&#x2F;&#x2F; and user-defined literals from C++11
auto vehicle = new Vehicle({
    .type = VehicleType::Car,
    .numberOfTires = 4,
    .tirePressure = {28_psi, 31_psi},
    .fuel = Fuel::Electric,
    .weight = 1.2_tn,
    .autonomy = 613_km,
});
</code></pre>
<p>Both second and C++20/C++11 alternatives are valid for a better readability of the code, to choose between both alternatives will depend of how are you going to design your API, probably if you are more familiar with the Qt API, the second version appears to be the most common, the C++20/C++11 alternative appears to be a bit more verbose but can be useful to avoid multiple function calls and helpful when dealing with a simpler code base.</p>
</li>
<li>
<p><strong>Encapsulate code when necessary</strong>, try to break functions in a more readable and explanatory way:</p>
<pre data-lang="cpp" class="language-cpp "><code class="language-cpp" data-lang="cpp">...&#x2F;&#x2F; Original version
void Serial::start_serial_communication() {
    &#x2F;&#x2F; Check if we are open to talk
    if (!_port || _port-&gt;register() != 0xb0001) {
        log(&quot;Serial port is not open!&quot;);
        return;
    }

    &#x2F;&#x2F; Send a 10ms serial break signal
    _port-&gt;set_break_enabled(true);
    msleep(10);
    _port-&gt;set_break_enabled(false);
    usleep(10);
    &#x2F;&#x2F; Send intercalated binary for detection
    _port-&gt;write(&#x27;U&#x27;);
    _port-&gt;flush();

    &#x2F;&#x2F; Send start AT command
    _port-&gt;write(&quot;AT+start&quot;);
}

&#x2F;&#x2F; Reviewer: Try to make it more readable encapsulating
&#x2F;&#x2F;            some functionalities

...&#x2F;&#x2F; Second version
bool Serial::is_port_open() {
    return !_port || _port-&gt;register() != 0xb0001;
}

void Serial::force_baudrate_detection() {
    &#x2F;&#x2F; Send a 10ms serial break signal
    _port-&gt;set_break_enabled(true);
    msleep(10);
    _port-&gt;set_break_enabled(false);
    usleep(10);
    &#x2F;&#x2F; Send intercalated binary for detection
    _port-&gt;write(&#x27;U&#x27;);
    _port-&gt;flush();
}

void Serial::send_message(Message message_type) {
    _port-&gt;write(messageFromType(message_type));
}

void Serial::start_serial_communication() {
    if (!is_port_open()) {
        log(&quot;Serial port is not open!&quot;);
        return;
    }

    force_baudrate_detection();
    send_message(Message::Start)
}
</code></pre>
<p>As you can see, the reason behind each block of code is clear now, and with that, the comments are also not necessary anymore, the code is friendly and readable enough that's possible to understand it without any comments, the function name does the job for free.</p>
</li>
<li>
<p><strong>Avoid comments</strong>, that's a clickbait, comments are really necessary, but they may be unnecessary when you are doing something that's really straightforward, and sometimes when something isn't, it's better to encapsulate it.</p>
<pre data-lang="cpp" class="language-cpp "><code class="language-cpp" data-lang="cpp">    ...&#x2F;&#x2F; Original version
    void blink_routine() {
        &#x2F;&#x2F; Use the LED builtin
        const int led_builtin = LED_BUILTIN;
        &#x2F;&#x2F; Configure ping to output
        setPinAsOutput(led_builtin);

        &#x2F;&#x2F; Loop forever
        while(true) {
            &#x2F;&#x2F; Turn the LED on
            turnPinOn(led_builtin);
            &#x2F;&#x2F; Wait for a second
            wait_seconds(1);
            &#x2F;&#x2F; Turn the LED off
            turnPinOff(led_builtin);
            &#x2F;&#x2F; Wait for a second
            wait_seconds(1);
        }
    }
</code></pre>
<p>Before checking the final version, let me talk more about it:</p>
<ul>
<li>
<p>For each line of code you'll have a comment (like a parrot that repeat what we say), and the worst thing about these comments is that the content is exactly what you can read from the code! You can think that this kind of comment is dead code, something that has the same meaning as the code, but it does not run, resulting in a duplicated amount of lines to maintain. If you forget to update each comment for each line of code, you'll have a comment that does not match with the code, and this will be pretty confuse for someone that's reading it.</p>
</li>
<li>
<p><strong>One of the most important skills about writing comments, is to know when not to write it!</strong></p>
</li>
<li>
<p>A comment should bring a value to the code, if you can remove the comment and the code can be understandable by a newcomer, the comment is not important.</p>
</li>
</ul>
<pre data-lang="cpp" class="language-cpp "><code class="language-cpp" data-lang="cpp">...&#x2F;&#x2F; Final version
    void blink_routine() {
        const int led_builtin = LED_BUILTIN;
        setPinAsOutput(led_builtin);

        while(true) {
            turnPinOn(led_builtin);
            wait_seconds(1);
            turnPinOff(led_builtin);
            wait_seconds(1);
        }
    }
</code></pre>
<p>There is a good video about this subject by <a href="https://www.youtube.com/watch?v=NLebZ3XT92E">Walter E. Brown in cppcon 2017, &quot;Whitespace ≤ Comments ＜＜ Code&quot;</a>.</p>
<p>And to finish, you should not avoid comments, you should understand when comments are necessary, like this:</p>
<pre data-lang="cpp" class="language-cpp "><code class="language-cpp" data-lang="cpp">&#x2F;&#x2F; From ArduPilot - GPIO_RPI
void set_gpio_mode_alt(int pin, int alternative) {
    &#x2F;&#x2F; **Moved content from cpp for this example**
    const uint8_t pins_per_register = 10;
    &#x2F;&#x2F; Calculates the position of the 3 bit mask in the 32 bits register
    const uint8_t tree_bits_position_in_register = (pin%pins_per_register)*3;
    &#x2F;** Creates a mask to enable the alternative function based in the following logic:
    *
    * | Alternative Function | 3 bits value |
    * |:--------------------:|:------------:|
    * |      Function 0      |     0b100    |
    * |      Function 1      |     0b101    |
    * |      Function 2      |     0b110    |
    * |      Function 3      |     0b111    |
    * |      Function 4      |     0b011    |
    * |      Function 5      |     0b010    |
    *&#x2F;
    const uint8_t alternative_value =
        (alternative &lt; 4 ? (alternative + 4) : (alternative == 4 ? 3 : 2));
    &#x2F;&#x2F; 0b00&#x27;000&#x27;000&#x27;000&#x27;000&#x27;000&#x27;000&#x27;ALT&#x27;000&#x27;000&#x27;000 enables alternative for the 4th pin
    const uint32_t mask_with_alt = static_cast&lt;uint32_t&gt;(alternative_value) &lt;&lt; tree_bits_position_in_register;
    const uint32_t mask = 0b111 &lt;&lt; tree_bits_position_in_register;
    &#x2F;&#x2F; Clear all bits in our position and apply our mask with alt values
    uint32_t register_value = _gpio[pin &#x2F; pins_per_register];
    register_value &amp;= ~mask;
    _gpio[pin &#x2F; pins_per_register] = register_value | mask_with_alt;
}
</code></pre>
<p>Mostly of the lines in this code can be impossible to understand without access or reading the datasheet directly,
the comments are here to understand what is going on and why, otherwise anyone that'll touch this code will need to do a reverse engineer to understand it.</p>
</li>
</ul>
<h1 id="development-flow">Development flow</h1>
<ul>
<li>
<p><strong>Avoid creating multiple Pull Requests (PRs)</strong>, update the ones that are still open.</p>
<ul>
<li>E.g: You created a Pull Request called &quot;Add button feature&quot;, some modifications will be necessary after the review process, and for that you'll need to update the same branch over creating new ones. That's necessary to help the project maintainers to see previous comments and the development history. Creating multiple PRs will only make the maintainers confuse and unable to track old comments, suggestions and your code changes between PRs.</li>
</ul>
</li>
<li>
<p><strong>Create atomic and self-contained commits</strong>, avoid doing multiple tasks in the same commit.</p>
<ul>
<li>
<p>E.g: You created a commit to fix the serial communication class, and inside the same commit you are doing 3 different tasks, removing trailing spaces, fixing a pointer validation check and a typo in the documentation of a different class. This appear to be silly and bureaucratic, but there are good reasons to break this simple commit and at least 3 different commits, one for the pointer check, a second one for the typo and a third one for the trailing space.</p>
<p>Developers usually track lines history to understand the changes behind a functionality, it's common to search with grep history from commits or line changes in specific commits to understand the history of a library, function, class, or a small feature, if the commits start to be polluted with unnecessary changes, this development practice will be almost impossible to be done, since a bunch of unrelated lines will me changed between commits and this technic will be unable to help the dear developer. <code>git blame</code> will also be of little help.</p>
<p>The example was also really simple, but you can imagine what happens if you change different parts of the code, for unrelated things, and a bug appears, technics such as <code>git bisect</code> will still work, but the result will be much harder to understand and to find which line is the one that created such bug.</p>
</li>
</ul>
</li>
<li>
<p><strong>Create atomic and self-sustained PRs</strong>, avoid doing multiple things in the same PR, like different features. They may appear simple with small pieces of code/functionality but they can escalate quickly after a review process, and if both features are somehow related or dependently, it's recommended to break it in multiple PRs with code to maintain compatibility with current code base.</p>
<ul>
<li>E.g: You have applied a PR for software notifications, and somehow you also added a URL fetch functionality to grab new software versions from the server. After the first review, the maintainer asks to create a more abstracted way to fetch data from a REST API and to deal with network requirements, this will start to convolute the PR, moving the initial idea of the notification feature to an entire network REST API architecture. With that, it's better to break the PR in two, one that only provides the notification and a second PR that is used for the REST API related code.</li>
</ul>
</li>
<li>
<p><strong>Do your own review</strong>, the final and probably most important tip of all, doing that will train your mind and eyes to detect poor code standards or bad practices, it'll also make your PR be merged easily and faster, since you'll be able to catch problems before the reviewer feedback. Some reviewers may think that reviewing your own PR is a must, since we are talking about open source projects and free software, you should understand that the people that are reviewing your code are not obligated to do so, the majority are collaborating and donating their own time to help the development and maintenance of such projects, doing your own review is a sign of empathy about the project and maintainer time.</p>
</li>
</ul>
<h1 id="final-comment">Final comment</h1>
<p>This is the first post of a series that I'm planning to do. Hope that some of these points may help you in your journey.</p>
<h2 id="references">References</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=MBRoCdtZOYg">CppCon 2019: Kate Gregory “Naming is Hard: Let's Do Better”</a></li>
<li><a href="https://www.youtube.com/watch?v=n0Ak6xtVXno">CppCon 2018: Kate Gregory “Simplicity: Not Just For Beginners”</a></li>
<li><a href="https://www.youtube.com/watch?v=kYVxGyido9g">CppCon 2018: Kate Gregory “What Do We Mean When We Say Nothing At All?”</a></li>
<li><a href="https://www.youtube.com/watch?v=YWiAUUblD34">CppCon 2017: Lars Knoll “Qt as a C++ Framework: History, Present State and Future”</a></li>
<li><a href="https://www.youtube.com/watch?v=XkDEzfpdcSg">CppCon 2017: Kate Gregory “10 Core Guidelines You Need to Start Using Now”</a></li>
<li><a href="https://wiki.qt.io/API_Design_Principles">API Design Principles - TQtC</a></li>
<li><a href="https://doc.qt.io/archives/qq/qq13-apis.html">Designing Qt-Style C++ APIs - Matthias Ettrich</a></li>
<li><a href="https://people.mpi-inf.mpg.de/%7Ejblanche/api-design.pdf">The Little Manual of API Design - Jasmin Blanchette</a></li>
</ul>

</div>

<footer>
  <p style="text-align: center;">If it was helpful, consider giving a start:</p>
  <!-- Place this tag where you want the button to render. -->
  <div style="text-align: center;">
    <a class="github-button" href="https://github.com/patrickelectric/patrickelectric.github.io" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star patrickelectric/patrickelectric.github.io on GitHub">Star</a>
  </div>
</footer>


        </div>

    </body>

</html>
