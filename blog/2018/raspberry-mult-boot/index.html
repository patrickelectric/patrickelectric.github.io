<!DOCTYPE html>
<html lang="en">
    <head>
      <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
      <link rel="manifest" href="/site.webmanifest">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta http-equiv="content-type" content="text/html; charset=utf-8">

      <!-- Enable responsiveness on mobile devices-->
      <!-- viewport-fit=cover is to support iPhone X rounded corners and notch in landscape-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

      <title>Patrick José Pereira</title>

      <!-- CSS -->
      <link rel="stylesheet" href="https://patrickelectric.work/print.css" media="print">
      <link rel="stylesheet" href="https://patrickelectric.work/poole.css">
      <link rel="stylesheet" href="https://patrickelectric.work/hyde.css">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

      <!-- Math rendering -->
	    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"
      onload="renderMathInElement(document.body, { delimiters: [ {left: '$$', right: '$$', display: true}, {left: '$', right: '$', display: false}, {left: '\\[', right: '\\]', display: true}, {left: '\\(', right: '\\)', display: false}]});"></script>

      
      

      
        <link rel="alternate" type="application/rss+xml" title="RSS" href="https://patrickelectric.work/rss.xml">
      
    </head>

    <body class=" ">
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/js/all.min.js"></script>
        
            <div class="sidebar">
                <div class="container sidebar-sticky">
                    <div class="sidebar-about">
                        
                          <a href="https:&#x2F;&#x2F;patrickelectric.work"><h2>HOME</h2></a>
                            <div class="avatar"> <img src="https://avatars3.githubusercontent.com/patrickelectric" alt="Patrick José Pereira" itemprop="image"> </div>
                            <h6>Patrick José Pereira</h6>
                            
                            <p class="lead">I am an Electronics Engineer that works with robotic systems, OSS and OSH.</p>
                            <div class="author__urls-wrapper">
                              <!-- Place this tag in your head or just before your close body tag. -->
                              <script async defer src="https://buttons.github.io/buttons.js"></script>
                              <!-- Place this tag where you want the button to render. -->
                              <a class="github-button" href="https://github.com/patrickelectric" data-show-count="true" aria-label="Follow @patrickelectric on GitHub">Follow @patrickelectric</a>
                              <ul class="author__urls social-icons">

                                  <li itemprop="homeLocation" itemscope="" itemtype="http://schema.org/Place">
                                    <i class="fas fa-map-marker-alt"></i> Brazil
                                  </li>
                                  <li>
                                    <a href="mailto:patrickjp@kde.org">
                                      <meta itemprop="email" content="patrickjp@kde.org">
                                      <i class="fas fa-envelope-square"></i> Email
                                    </a>
                                  </li>
                                  <li>
                                    <a href="https://github.com/patrickelectric">
                                      <i class="fab fa-github-square"></i> GitHub
                                    </a>
                                  </li>
                                  <li>
                                    <a href="https://www.linkedin.com/in/patrickelectric/">
                                      <i class="fab fa-linkedin"></i> LinkedIn
                                    </a>
                                  </li>
                              </ul>
                            </div>
                            
                        
                    </div>

                    <ul class="sidebar-nav">
                        
                        
                        
                    </ul>
                </div>
            </div>
        

        <div class="content container">
            
<div class="post">
  <h1 class="post-title">Raspberry Pi with multiboot (multiple rootfs)</h1>
  <span class="post-date">2018-08-19</span>
  <h3 class="post-tags">[
  
  <a href="/tags/raspberry">raspberry</a>
  
  <a href="/tags/boot">boot</a>
  
  ]</h3>
  <p>One question that I receive (from my friends, myself and people that install archlinux at 3am) appears every time. <em>How to create a multiboot architecture inside a sdcard for the Raspberry Pi ?</em></p>
<p>After a boring day doing some unrelated stuff out of home, and with 1h free to do something before sleep and eating (heating my frozen lasagna), why not solving that <del>secular</del> question that follow me ?</p>
<span id="continue-reading"></span>
<p>I took some time to think about it: <a href="https://wiki.archlinux.org/index.php/Category:Boot_loaders">maybe doing something related to the archlinux boot section</a>, or with <a href="https://github.com/raspberrypi/noobs">noobs</a>, and maybe with <a href="https://www.berryterminal.com/doku.php/berryboot">BerryBoot</a>.</p>
<p>With 1h-ish free I did remove all non-trivial ways.</p>
<ul>
<li>archlinux: The script will use all the sdcard, changing the scripts will take time.</li>
<li>noobs: It does not appears to be the correct tool, some investigation shows that.</li>
<li>BerryBoot: Appears to be the way to go, but it'll take time also to configure everything.</li>
</ul>
<h1 id="doing-the-hard-stuff-with-no-sweat">Doing the hard stuff with no sweat</h1>
<p>So, the idea now is to break everything and try something new. <strong>Use Raspbian image, create a second rootfs partition, change the rootfs in /boot</strong>, sounds simple, easy and fast !</p>
<ol>
<li>
<p><a href="https://www.raspberrypi.org/downloads/raspbian/">Download Raspbian</a> (I did everything with Raspbian stretch lite).</p>
</li>
<li>
<p>Burn the sdcard with Etcher (I like dd, but Etcher is so simple!).</p>
</li>
<li>
<p>Use gparted to create a second partition with the same configuration of the /rootfs one ! (rootfs2).</p>
<p><img src="/assets/raspberry_multiboot/gparted.png" alt="LaKademy2017" /></p>
</li>
<li>
<p>Make a copy of our old <em>rootfs</em>. <code>sudo cp /mount_point_of_rootfs/* /mount_point_of_rootfs2/* -r</code></p>
</li>
<li>
<p>Now, with everything ready, we should update the partuuid values of <code>/etc/fstab</code> and <code>/boot/cmdline.txt</code>. (<code>sudo blkid</code>)</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>/dev/mmcblk0p1: LABEL=&quot;boot&quot; UUID=&quot;3725-1C05&quot; TYPE=&quot;vfat&quot; PARTUUID=&quot;0155ef5b-01&quot;
</span><span>/dev/mmcblk0p2: LABEL=&quot;rootfs&quot; UUID=&quot;fd695ef5-f047-44bd-b159-2a78c53af20a&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;0155ef5b-02&quot;
</span><span>/dev/mmcblk0p3: LABEL=&quot;rootfs2&quot; UUID=&quot;3da53eaa-4044-4554-8052-0f8c225f7b8c&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;0155ef5b-03&quot;
</span></code></pre>
</li>
<li>
<p>With all partitions mounted, update:</p>
<ul>
<li><code>/boot/cmdline.txt</code>: partuuid of <code>/rootfs</code> to 0155ef5b-<strong>02</strong></li>
<li><code>/rootfs/etc/fstab</code>: partuuid of <code>/boot</code> to 0155ef5b-<strong>01</strong> and <code>/</code> to 0155ef5b-<strong>02</strong></li>
<li><code>/rootfs2/etc/fstab</code>: partuuid of <code>/boot</code> to 0155ef5b-<strong>01</strong> and <code>/</code> to 0155ef5b-<strong>03</strong></li>
</ul>
</li>
<li>
<p>To change which rootfs you want to boot, just need to change the suffix of the partuuid in <code>/boot/cmdline.txt</code>.</p>
</li>
</ol>
<p>The <strong>01</strong> suffix is the boot partition (<code>/boot</code>), <strong>02</strong> is our &quot;recovery&quot; partition with 700MB free (<code>/rootfs</code>), and our last and probably the &quot;main&quot; partition with 13GB free is the one with <strong>03</strong> suffix (<code>/rootfs2</code>).</p>
<h2 id="notes">Notes</h2>
<ul>
<li>This may not work with different kernels because of the initramfs.</li>
<li>If you want to improve this article, please send a <a href="http://github.com/patrickelectric/patrickelectric.github.io">PR in my github</a> !</li>
</ul>

</div>

<footer>
  <p style="text-align: center;">If it was helpful, consider giving a start:</p>
  <!-- Place this tag where you want the button to render. -->
  <div style="text-align: center;">
    <a class="github-button" href="https://github.com/patrickelectric/patrickelectric.github.io" data-icon="octicon-star" data-size="large" data-show-count="true" aria-label="Star patrickelectric/patrickelectric.github.io on GitHub">Star</a>
  </div>
</footer>


  
  <script
    src="https://utteranc.es/client.js"
    repo="patrickelectric&#x2F;patrickelectric.github.io"
    issue-term="pathname"
    label="Comments"
    theme="github-light"
    crossorigin="anonymous"
    async
  ></script>
  



        </div>

    </body>

</html>
